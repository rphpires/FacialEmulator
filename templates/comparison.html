{% extends 'base.html' %}

{% block content %}

<div class="container mt-4">
  <div class="row align-items-center">
    <div class="col-md-6">
      <h3 class="display-8">Comparação</h3>
    </div>
    <div class="col-md-6 text-end">
      <button class="btn btn-outline-primary ms-2" onclick="refresh_counter()">
        <i class="bi bi-arrow-clockwise"></i> Refresh
      </button>
    </div>
  </div>
  
  <table class="table table-striped table-hover mt-3" id="count-table">
    <thead>
      <tr>
        <th scope="col" class="text-center">SiteControllerID</th>
        <th scope="col" class="text-center">LocalControllerID</th>
        <th scope="col" class="text-center">Nome</th>
        <th scope="col" class="text-center">Porta</th>
        <th scope="col" class="text-center">Total: Banco de dados</th>
        <th scope="col" class="text-center">Total: Gerenciador</th>
        <th scope="col" class="text-center">Total: Emulador</th>
        <th scope="col" class="text-center">Status</th>
      </tr>
    </thead>
    <tbody>
      {% for v in values %}
        {% set row_class = '' %}
        {% if v.wxs_total != v.site_controller_total or v.wxs_total != v.emulator_total or v.site_controller_total != v.emulator_total %}
          {% set row_class = 'bg-danger-subtle' %}
        {% endif %}
        <tr id="value_{{ v.lc_id }}" class="{{ row_class }}">
          <td class="text-center">{{ v.site_controller_id }}</td>
          <td class="text-center">{{ v.local_controller_id }}</td>
          <td class="text-center">{{ v.name }}</td>
          <td class="text-center" id="port_no">{{ v.port }}</td>
          <td class="text-center">{{ v.wxs_total }}</td>
          <td class="text-center">{{ v.site_controller_total }}</td>
          <td class="text-center">{{ v.emulator_total }}</td>
          {% if v.wxs_total != v.site_controller_total or v.wxs_total != v.emulator_total or v.site_controller_total != v.emulator_total %}
            <td class="text-center">
              <span class="border border-danger" style="padding: 5px; border-radius: 5px; color: #a70000;">Error</span>
            </td>
          {% else %}
            <td class="text-center">
              <span class="border border-success" style="padding: 5px; border-radius: 5px; color: #117529;">OK</span>
            </td>
          {% endif %}
          
        </tr>
      {% endfor %}
    </tbody>
  </table>


  <div class="d-flex justify-content-center align-items-center position-relative">
    <!-- Controle de quantidade de itens por página, ao lado esquerdo da paginação -->
    <div class="d-flex align-items-center position-absolute start-0">
      <label for="per-page-select" class="form-label mb-0 me-2">Itens por página:</label>
      <select id="per-page-select" class="form-select" style="width: auto;" onchange="changePerPage()">
        <option value="5" {% if per_page == 5 %}selected{% endif %}>5</option>
        <option value="10" {% if per_page == 10 %}selected{% endif %}>10</option>
        <option value="20" {% if per_page == 20 %}selected{% endif %}>20</option>
      </select>
    </div>
    
    <!-- Paginação centralizada -->
    <nav>
      <ul class="pagination mb-0">
        <li class="page-item {% if page == 1 %}disabled{% endif %}">
          <a class="page-link" href="/comparison?page={{ page-1 }}&per_page={{ per_page }}">Anterior</a>
        </li>
        {% for p in range(1, total_pages + 1) %}
        <li class="page-item {% if page == p %}active{% endif %}">
          <a class="page-link" href="/comparison?page={{ p }}&per_page={{ per_page }}">{{ p }}</a>
        </li>
        {% endfor %}
        <li class="page-item {% if page == total_pages %}disabled{% endif %}">
          <a class="page-link" href="/comparison?page={{ page+1 }}&per_page={{ per_page }}">Próxima</a>
        </li>
      </ul>
    </nav>
  </div>
</div>
  
<script>
  function changePerPage() {
    const perPage = document.getElementById('per-page-select').value;
    window.location.href = `/comparison?page=1&per_page=${perPage}`;
  }

  window.refresh_counter = async () => {
      try {
        const response = await fetch('/comparison_refresh', {
          method: 'GET',
          headers: {
            'Content-Type': 'application/json',
          }
        });
      } catch (error) {
        console.error('Erro ao iniciar emuladores:', error);
        alert('Erro ao iniciar emuladores.');
      }
    };
</script>

<style>
  .bg-danger-subtle {
    background-color: #f8d7da !important; /* Exemplo de vermelho claro com !important */
  }

  /* Aumentando a especificidade para garantir que a cor seja aplicada corretamente */
  #count-table tbody tr.bg-danger-subtle {
    background-color: #f8d7da !important;
  }
</style>

{% endblock %}
